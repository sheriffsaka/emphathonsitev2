
-- Enable the necessary extensions
create extension if not exists "uuid-ossp";

-- 1. CARS TABLE
create table public.cars (
  id uuid default uuid_generate_v4() primary key,
  brand text not null,
  model text not null,
  year integer not null,
  price numeric not null,
  mileage integer not null,
  transmission text check (transmission in ('Automatic', 'Manual', 'PDK', 'E-Drive')),
  fuel_type text check (fuel_type in ('Petrol', 'Hybrid', 'Electric', 'Diesel')),
  status text check (status in ('Available', 'Reserved', 'Pre-Order')),
  condition text check (condition in ('New', 'Used', 'Certified Pre-Owned')), 
  buyer_type text[] not null,
  image_url text not null,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 2. PREORDERS TABLE
create table public.preorders (
  id uuid default uuid_generate_v4() primary key,
  full_name text not null,
  email text not null,
  phone text,
  brand text,
  model text,
  color text,
  expected_delivery date,
  notes text,
  buyer_type text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 3. APPOINTMENTS TABLE
create table public.appointments (
  id uuid default uuid_generate_v4() primary key,
  full_name text not null,
  email text not null,
  phone text,
  appointment_date date,
  message text,
  visit_type text,
  buyer_type text,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 4. HERO_MEDIA TABLE
create table public.hero_media (
  id uuid default uuid_generate_v4() primary key,
  title text not null,
  subtitle text,
  image_url text not null,
  cta_primary_text text,
  cta_primary_link text,
  cta_secondary_text text,
  cta_secondary_link text,
  display_order integer default 0,
  is_active boolean default true,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 5. TESTIMONIALS TABLE
create table public.testimonials (
  id uuid default uuid_generate_v4() primary key,
  client_name text not null,
  role text,
  client_type text check (client_type in ('Corporate', 'Individual')),
  content text not null,
  rating integer check (rating >= 1 and rating <= 5),
  avatar_url text,
  car_purchased_image_url text,
  is_verified boolean default true,
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 6. INQUIRIES TABLE (General Contact)
create table public.inquiries (
  id uuid default uuid_generate_v4() primary key,
  name text not null,
  email text not null,
  subject text,
  message text not null,
  status text default 'New', 
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- 7. CORPORATE_REQUESTS TABLE (Specific Bulk Fleet Requests)
create table public.corporate_requests (
  id uuid default uuid_generate_v4() primary key,
  company_name text not null,
  contact_person text not null,
  email text not null,
  fleet_size_interest integer,
  requested_models text[],
  status text default 'Pending',
  created_at timestamp with time zone default timezone('utc'::text, now()) not null
);

-- ENABLE ROW LEVEL SECURITY
alter table public.cars enable row level security;
alter table public.preorders enable row level security;
alter table public.appointments enable row level security;
alter table public.hero_media enable row level security;
alter table public.testimonials enable row level security;
alter table public.inquiries enable row level security;
alter table public.corporate_requests enable row level security;

-- GENERIC PUBLIC READ POLICIES
create policy "Public read cars" on public.cars for select to anon using (true);
create policy "Public read hero" on public.hero_media for select to anon using (true);
create policy "Public read testimonials" on public.testimonials for select to anon using (true);

-- GENERIC PUBLIC INSERT POLICIES
create policy "Public insert preorders" on public.preorders for insert to anon with check (true);
create policy "Public insert appointments" on public.appointments for insert to anon with check (true);
create policy "Public insert inquiries" on public.inquiries for insert to anon with check (true);
create policy "Public insert corporate" on public.corporate_requests for insert to anon with check (true);

-- ==========================================
-- SEED DATA 
-- ==========================================

-- Clean existing data to prevent duplicates if re-running
TRUNCATE public.cars, public.hero_media, public.testimonials RESTART IDENTITY CASCADE;

-- 1. CARS
INSERT INTO public.cars (brand, model, year, price, mileage, transmission, fuel_type, status, condition, buyer_type, image_url)
VALUES
  ('Mercedes-Benz', 'GLE 350 4MATIC', 2021, 65000000, 12000, 'Automatic', 'Petrol', 'Available', 'Used', ARRAY['Corporate', 'Individual'], 'https://images.unsplash.com/photo-1617788138017-80ad40651399?auto=format&fit=crop&q=80&w=800'),
  ('Mercedes-Benz', 'GLE 350', 2018, 38000000, 45000, 'Automatic', 'Petrol', 'Available', 'Used', ARRAY['Individual'], 'https://images.unsplash.com/photo-1605218427368-35b861280386?auto=format&fit=crop&q=80&w=800'),
  ('Mercedes-Benz', 'ML 350', 2014, 18500000, 85000, 'Automatic', 'Petrol', 'Available', 'Used', ARRAY['Individual', 'Corporate'], 'https://images.unsplash.com/photo-1553440637-d22ed8a02575?auto=format&fit=crop&q=80&w=800'),
  ('Toyota', 'Corolla LE', 2021, 16500000, 15000, 'Automatic', 'Petrol', 'Pre-Order', 'Certified Pre-Owned', ARRAY['Individual', 'Corporate'], 'https://images.unsplash.com/photo-1623869675781-80e6568f9aa7?auto=format&fit=crop&q=80&w=800'),
  ('Toyota', 'Corolla S', 2015, 9500000, 92000, 'Automatic', 'Petrol', 'Available', 'Used', ARRAY['Individual'], 'https://images.unsplash.com/photo-1590362891991-f776e747a588?auto=format&fit=crop&q=80&w=800'),
  ('Hyundai', 'Sonata', 2016, 8500000, 78000, 'Automatic', 'Petrol', 'Available', 'Used', ARRAY['Individual'], 'https://images.unsplash.com/photo-1549399542-7e3f8b79c341?auto=format&fit=crop&q=80&w=800'),
  ('Hyundai', 'Elantra', 2014, 6500000, 105000, 'Automatic', 'Petrol', 'Available', 'Used', ARRAY['Individual'], 'https://images.unsplash.com/photo-1616422285623-13ff0162193c?auto=format&fit=crop&q=80&w=800');

-- 2. HERO MEDIA
INSERT INTO public.hero_media (title, subtitle, image_url, cta_primary_text, cta_secondary_text, display_order)
VALUES
  ('GLE Authority (2020-22)', 'The pinnacle of modern luxury. Experience the refined 2020-2022 Mercedes-Benz GLE 350.', 'https://images.unsplash.com/photo-1617788138017-80ad40651399?auto=format&fit=crop&q=80&w=2560', 'View Inventory', 'Reserve Now', 1),
  ('Defined by Legacy (2016-19)', 'The 2016-2019 Mercedes GLE 350. A testament to enduring performance and style.', 'https://images.unsplash.com/photo-1605218427368-35b861280386?auto=format&fit=crop&q=80&w=2560', 'View Specs', 'Inquire', 2),
  ('The Robust ML350', '2012-2015 Mercedes ML350. The classic SUV that defined a generation of corporate transport.', 'https://images.unsplash.com/photo-1553440637-d22ed8a02575?auto=format&fit=crop&q=80&w=2560', 'Check Availability', 'Contact', 3),
  ('Modern Efficiency', '2020-2022 Toyota Corolla. Reliability meets contemporary design for the modern fleet.', 'https://images.unsplash.com/photo-1623869675781-80e6568f9aa7?auto=format&fit=crop&q=80&w=2560', 'View Corollas', 'Bulk Order', 4),
  ('Proven Reliability', '2014-2016 Toyota Corolla. The cost-effective backbone of executive logistics.', 'https://images.unsplash.com/photo-1590362891991-f776e747a588?auto=format&fit=crop&q=80&w=2560', 'View Details', 'Contact', 5),
  ('Sonata Executive', '2015-2017 Hyundai Sonata. Spacious comfort for the discerning passenger.', 'https://images.unsplash.com/photo-1549399542-7e3f8b79c341?auto=format&fit=crop&q=80&w=2560', 'Explore Fleet', 'Inquire', 6),
  ('Elantra Compact', '2012-2016 Hyundai Elantra. Agile, efficient, and ready for urban deployment.', 'https://images.unsplash.com/photo-1616422285623-13ff0162193c?auto=format&fit=crop&q=80&w=2560', 'View Stock', 'Contact', 7);

-- 3. TESTIMONIALS
INSERT INTO public.testimonials (client_name, role, client_type, content, rating, avatar_url, car_purchased_image_url)
VALUES
  ('Alexander V.', 'Procurement Director, TechCorp', 'Corporate', 'Empathon managed our fleet refresh efficiently. We sourced 5 units of the 2021 Corolla for our sales team. Delivery was prompt.', 5, 'https://images.unsplash.com/photo-1560250097-0b93528c311a?auto=format&fit=crop&q=80&w=200', 'https://images.unsplash.com/photo-1623869675781-80e6568f9aa7?auto=format&fit=crop&q=80&w=200'),
  ('Elena R.', 'Private Buyer', 'Individual', 'I was looking for a clean ML350 for months. Empathon found a 2014 model with low mileage and excellent condition.', 5, 'https://images.unsplash.com/photo-1573496359-1508d476fbfb?auto=format&fit=crop&q=80&w=200', 'https://images.unsplash.com/photo-1606220838315-056192d5e927?auto=format&fit=crop&q=80&w=200'),
  ('Marcus T.', 'Business Owner', 'Corporate', 'Upgraded my personal vehicle to a 2018 GLE350. The transaction was seamless and handled in Naira without complex FX issues.', 5, 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?auto=format&fit=crop&q=80&w=200', 'https://images.unsplash.com/photo-1553440637-d22ed8a02575?auto=format&fit=crop&q=80&w=200');
